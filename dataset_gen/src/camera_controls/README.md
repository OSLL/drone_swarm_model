# Controller.py
## Запуск
Запуск контроллера дронов
```sh
rosrun camera_controls controller.py
```
## Работа с контроллером
Движение дрона *drone_name* в глобальные координаты *x y z*
```sh
move drone_name x y z
```
Движение дрона *drone_name* в локальные координаты *x y z*
```sh
move_direct drone_name x y z
```
Поворот дрона *drone_name* по осям roll, pitch, yaw на значения *roll pitch yaw* глобально
```sh
rotate drone_name roll pitch yaw
```
Поворот дрона *drone_name* по осям roll, pitch, yaw на значения *roll pitch yaw* локально
```sh
rotate_direct drone_name roll pitch yaw
```
Движение дрона *drone_name* в глобальные координаты *x y z* и поворот по осям roll, pitch, yaw на значения *roll pitch yaw* глобально
```sh
translate drone_name x y z roll pitch yaw
```
Движение дрона *drone_name* в локальные координаты *x y z* и поворот по осям roll, pitch, yaw на значения *roll pitch yaw* локально
```sh
translate_direct drone_name x y z roll pitch yaw
```
## Описание контроллера
При запуске контроллера пользователю выводится справка команд для управления контроллером. Контроллер считывает верно введенные команды, глобальные координаты переводит в локальные и передает обработанные параметры *x y z roll pitch yaw* в топик *drone_name/cmd_move* сообщением типа *camera_controls/msg_transposition*. В случае неверных команд или отсутствия данных о дроне выводится сообщение об ошибке.
Созданный тип сообщения имеет структуру:
```sh
float64 x
float64 y
float64 z
float64 roll
float64 pitch
float64 yaw
```
# Odometry.py
## Запуск
Запуск узла одометрии дронов
```sh
rosrun camera_controls odometry.py
```
## Описание одометрии
Считываются данные об ориентации всех дронов и публикуются в инвидуальные топики *drone_name/odom* под каждый дрон раз в секунду сообщением типа *camera_controls/msg_odometry*. Когда считывание данных невозможно, раз в секунду выводится сообщение об ошибке.
Созданный тип сообщения имеет структуру:
```sh
float64 x
float64 y
float64 z
float64 w
```
# Rosbag_recorder.py
## Запуск
Запуск узла rosbag записи для дрона *drone_name* для одного топика
```sh
rosrun camera_controls rosbag_recorder.py drone_name topic_name_without_drone_name_part
```
Запуск узла rosbag записи для дрона *drone_name* для двух топиков
```sh
rosrun camera_controls rosbag_recorder.py drone_name topic1_name_without_drone_name_part topic2_name_without_drone_name_part
```
## Работа с узлом rosbag записи
Запуск записи
```sh
start record
```
Запуск записи через топик для команд
```sh
rostopic pub /rosbag_command std_msgs/String "start record"
```
Остановка записи
```sh
stop record
```
Остановка записи через топик для команд
```sh
rostopic pub /rosbag_command std_msgs/String "stop record"
```
Запуск записи на *n* секунд
```sh
record during n
```
Запуск записи на *n* секунд через топик для команд
```sh
rostopic pub /rosbag_command std_msgs/String "record during n"
```
## Описание узла rosbag записи
После верно введенного запуска узла rosbag записи проводится проверка возможности записи заданных топиков. В случае невозможности узел ждет 10 секунд, проверяя в это время доступность топиков, если через 10 секунд доступа ко всем заданным топикам нет, то программа завершает работу. Пользователя в такой ситуации уведомляет следующее сообщение *Waiting for /topics_name publishers*,в котором в случае недоступности всех заданных топиков каждую секунду добавляется точка и после 10 секунд *There is no publishers for topics: /topics_name*. В случае успешности выводится справка команд для управления записью. Узел rosbag записи считывает верно введенные команды и регулирует rosbag запись. Работает защита записи, которая не запускает новые записи, пока идет другая. Каждая запись сохраняется в свой файл *rosbag<number_of_record>.bag*. Перед каждой записью производится такая же проверка доступности всех заданных топиков, как и в начале, но в случае недоступности программа не завершает работу, вместо этого не запускается запись. В случае записи одного топика запись производится напрямую, в случае записи двух топиков запись производится в синхронизированном режиме со специальных топиков */rosbag_sync_topic* и */rosbag_sync_topic2*. Программа универсальна для любых типов сообщений.

# Parse_rosbag.py
## Запуск
Запуск парсера rosbag файла *rosbag_file_name.bag*. Опционально можно выбрать с помощью параметра *-o* имя csv файла *name_of_out_file*.
```sh
python3 parse_rosbag.py rosbag_file_name.bag -o name_of_out_file
```
## Описание парсера rosbag файла
Программа переводит bag файл в csv файл. Файл будет иметь имя либо то же, что и bag файл, либо то, что указал пользователь. Файл сохраняется в папке с именем bag файла. Программа работает с bag файлами, которые содержат один и два топика.


## driver.py
### Запуск
Запуск драйвера, который будет управлять дроном с 
именем *drone_name*
```bash
rosrun camera_controls driver.py __name:=drone_name
```

## Описание работы
Драйвер получает сообщения из топика *drone_name/cmd_move* и осуществляет
телепортацию дрона в соответствии с переданными параметрами. Если симуляция не запущена или дрона 
с именем *drone_name* нет на карте, то раз в секунду драйвер будет выводить сообщение: 
- '*Simulation is not running*' 
для случая, если симуляция не запущена, 
- '*Drone named 'drone_name' is not on the map'* если дрона с именем *drone_name* нет на карте.
- *''drone_name' driver ready to receive messages'* ,когда драйверу удаётся соединиться с дроном (данное сообщение выводится один раз)

## Описание получаемого сообщения
Драйвер получает сообщения типа *camera_controls/msg_transposition*

Структура сообщения следующая
```
float64 x - смещение по оси x
float64 y - смещение по оси y
float64 z - смещение по оси z
float64 roll - угол поворота вокруг оси x 
float64 pitсh - угол поворота вокруг оси y
float64 yaw - угол поворота вокруг оси z
```
Углы поворота указываются в радианах

# driver_velocity_based.py
## Запуск
Запуск драйвера, который будет управлять дроном с 
именем *drone_name*
```bash
rosrun camera_controls driver_velocity_based.py __name:=drone_name
```

## Описание работы
Драйвер получает сообщения из топика *drone_name/cmd_vel* и осуществляет
плавное перемещение дрона с соответствии с указанными в переданном сообщении параметрами. Если симуляция не запущена или дрона 
с именем *drone_name* нет на карте, то раз в секунду драйвер будет выводить сообщение: 
- '*Simulation is not running*' 
для случая, если симуляция не запущена, 
- '*Drone named 'drone_name' is not on the map'* если дрона с именем *drone_name* нет на карте.
- *''drone_name' driver ready to receive messages'* ,когда драйверу удаётся соединиться с дроном (данное сообщение выводится один раз)

## Описание получаемого сообщения
Драйвер получает сообщения типа *camera_controls/msg_transposition*

Структура сообщения следующая
```
float64 x - скорость передвижения по оси x
float64 y - скорость передвижения по оси y
float64 z - скорость передвижения по оси z
float64 roll - скорость поворота вокруг оси x 
float64 pitсh - скорость поворота вокруг оси y
float64 yaw - скорость поворота вокруг оси z
```
Углы поворота указываются в радианах

# teleop.py
## Запуск
Запуск ноды, осуществляющей управление дроном с именем *drone_name* через топик */drone_name/cmd_vel* с помощью клавиатуры
```bash
rosrun camera_controls teleop.py _topic:=/drone_name/cmd_vel   __name:=some_name
```
Так как одна нода teleop отвечает за один дрон, то значение __name должно быть уникальным

## Описание работы
Нода дистанционного управления считывает ввод с клавиатуры и на его основании формирует сообщение типа *camera_controls/msg_transposition*, 
которое передает драйверу соответствующего дрона через топик, заданный параметром *topic*. Если нода дистанционного управления не может найти драйвер нужного дрона
, то раз в секунду она будет выводить сообщение: 
- '*No driver found for the drone named 'drone_name'*'

Когда нода дистанционного управления смогла подключиться к дрону, она уведомляет об этом, выводя на экран сообщение:  
- '*Driver for drone 'drone_name' found*'

Управление дроном осуществляется с помощью клавиатуры:
- w - s — изменение скорости вдоль оси *x*
- d - a — изменение скорости вдоль оси *y*
- b - space  — изменение скорости вдоль оси *z*
- i - k  — изменение скорости вращения вокруг оси *x* (угол *roll*)
- l - j  — изменение скорости вращения вокруг оси *y* (угол *pitch*)
- u - o  — изменение скорости вращения вокруг оси *z* (угол *yaw*)

## Описание передаваемого сообщения
Нода дистанционного управления формирует и отправляет сообщения типа *camera_controls/msg_transposition*

Структура сообщения следующая
```
float64 x - скорость передвижения по оси x
float64 y - скорость передвижения по оси y
float64 z - скорость передвижения по оси z
float64 roll - скорость поворота вокруг оси x 
float64 pitсh - скорость поворота вокруг оси y
float64 yaw - скорость поворота вокруг оси z
```
Углы поворота указываются в радианах

